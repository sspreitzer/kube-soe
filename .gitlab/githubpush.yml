githubpush:
  image: alpine/git
  script:
    - mkdir ${HOME}/.ssh
    - cat .gitlab/.ssh/known_hosts > ${HOME}/.ssh/known_hosts
    - echo "${github_ssh_privkey_base64}" | base64 -d > ${HOME}/.ssh/id_ed25519
    - chmod 0600 ${HOME}/.ssh/known_hosts
    - chmod 0600 ${HOME}/.ssh/id_ed25519
    - chmod 0700 ${HOME}/.ssh
    - D=$(mktemp -d)
    - git clone --mirror ${CI_REPOSITORY_URL} ${D}
    - cd ${D}
    - git remote add github ${GITHUB_REPOSITORY_URL}
    - git push --mirror github
    - cd -
    - rm -rf ${D}
  after_script:
    - shred -u ${HOME}/.ssh/id_ed25519
